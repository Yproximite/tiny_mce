tinymce.PluginManager.add("lists",function(e){var t=this;e.on("init",function(){function n(e){function t(t){var r,i,o;i=e[t?"startContainer":"endContainer"],o=e[t?"startOffset":"endOffset"],1==i.nodeType&&(r=L.create("span",{"data-mce-type":"bookmark"}),i.hasChildNodes()?(o=Math.min(o,i.childNodes.length-1),t?i.insertBefore(r,i.childNodes[o]):L.insertAfter(r,i.childNodes[o])):i.appendChild(r),i=r,o=0),n[t?"startContainer":"endContainer"]=i,n[t?"startOffset":"endOffset"]=o}var n={};return t(!0),e.collapsed||t(),n}function r(e){function t(t){function n(e){for(var t=e.parentNode.firstChild,n=0;t;){if(t==e)return n;(1!=t.nodeType||"bookmark"!=t.getAttribute("data-mce-type"))&&n++,t=t.nextSibling}return-1}var r,i,o;r=o=e[t?"startContainer":"endContainer"],i=e[t?"startOffset":"endOffset"],r&&(1==r.nodeType&&(i=n(r),r=r.parentNode,L.remove(o)),e[t?"startContainer":"endContainer"]=r,e[t?"startOffset":"endOffset"]=i)}t(!0),t();var n=L.createRng();n.setStart(e.startContainer,e.startOffset),e.endContainer&&n.setEnd(e.endContainer,e.endOffset),b.setRng(n)}function i(e){return e&&/^(OL|UL)$/.test(e.nodeName)}function o(e){return e.parentNode.firstChild==e}function a(e){return e.parentNode.lastChild==e}function d(t){return t&&!!e.schema.getTextBlockElements()[t.nodeName]}function f(e){return e&&"SPAN"===e.nodeName&&"bookmark"===e.getAttribute("data-mce-type")}function s(t,n){var r,i,o;if(e.settings.forced_root_block&&(n=n||e.settings.forced_root_block),i=n?L.create(n):L.createFragment(),t)for(;r=t.firstChild;)o||"SPAN"==r.nodeName&&"bookmark"==r.getAttribute("data-mce-type")||(o=!0),i.appendChild(r);return e.settings.forced_root_block?o||tinymce.Env.ie&&!(tinymce.Env.ie>10)||i.appendChild(L.create("br",{"data-mce-bogus":"1"})):i.appendChild(L.create("br")),i}function c(){return tinymce.grep(b.getSelectedBlocks(),function(e){return"LI"==e.nodeName})}function l(e,t,n){var r,i,o=L.select('span[data-mce-type="bookmark"]',e);n=n||s(t),r=L.createRng(),r.setStartAfter(t),r.setEndAfter(e),i=r.extractContents(),L.isEmpty(i)||L.insertAfter(i,e),L.insertAfter(n,e),L.isEmpty(t.parentNode)&&(tinymce.each(o,function(e){t.parentNode.parentNode.insertBefore(e,t.parentNode)}),L.remove(t.parentNode)),L.remove(t)}function u(e){var t,n;if(t=e.nextSibling,t&&i(t)&&t.nodeName==e.nodeName){for(;n=t.firstChild;)e.appendChild(n);L.remove(t)}if(t=e.previousSibling,t&&i(t)&&t.nodeName==e.nodeName){for(;n=t.firstChild;)e.insertBefore(n,e.firstChild);L.remove(t)}}function p(e){tinymce.each(tinymce.grep(L.select("ol,ul",e)),function(e){var t,n=e.parentNode;"LI"==n.nodeName&&n.firstChild==e&&(t=n.previousSibling,t&&"LI"==t.nodeName&&(t.appendChild(e),L.isEmpty(n)&&L.remove(n))),i(n)&&(t=n.previousSibling,t&&"LI"==t.nodeName&&t.appendChild(e))})}function m(e){function t(e){L.isEmpty(e)&&L.remove(e)}var n,r=e.parentNode,d=r.parentNode;if(o(e)&&a(e))if("LI"==d.nodeName)L.insertAfter(e,d),t(d),L.remove(r);else{if(!i(d))return d.insertBefore(s(e),r),L.remove(r),void 0;L.remove(r,!0)}else if(o(e))if("LI"==d.nodeName)L.insertAfter(e,d),n=L.create("LI"),n.appendChild(r),L.insertAfter(n,e),t(d);else{if(!i(d))return d.insertBefore(s(e),r),L.remove(e),void 0;d.insertBefore(e,r)}else if(a(e))if("LI"==d.nodeName)L.insertAfter(e,d);else{if(!i(d))return L.insertAfter(s(e),r),L.remove(e),void 0;L.insertAfter(e,r)}else"LI"==d.nodeName?(r=d,n=s(e,"LI")):n=i(d)?s(e,"LI"):s(e),l(r,e,n),p(r.parentNode);return!0}function v(e){var t,n;return t=e.previousSibling,t&&"UL"==t.nodeName?(t.appendChild(e),void 0):t&&"LI"==t.nodeName&&i(t.lastChild)?(t.lastChild.appendChild(e),void 0):(t=e.nextSibling,t&&"UL"==t.nodeName?(t.insertBefore(e,t.firstChild),void 0):t&&"LI"==t.nodeName&&i(e.lastChild)?void 0:(t=e.previousSibling,t&&"LI"==t.nodeName&&(n=L.create(e.parentNode.nodeName),t.appendChild(n),n.appendChild(e)),!0))}function N(){var e,t=n(b.getRng(!0));return tinymce.each(c(),function(t){v(t)&&(e=!0)}),r(t),e}function h(){var e,t=n(b.getRng(!0));return tinymce.each(c(),function(t){m(t)&&(e=!0)}),r(t),e}function C(t){function o(){function t(e){var t,n;for(t=a[e?"startContainer":"endContainer"],n=a[e?"startOffset":"endOffset"],1==t.nodeType&&(t=t.childNodes[Math.min(n,t.childNodes.length-1)]||t);t.parentNode!=i;){if(d(t))return t;if(/^(TD|TH)$/.test(t.parentNode.nodeName))return t;t=t.parentNode}return t}for(var n,r=[],i=e.getBody(),o=t(!0),s=t(),c=[],l=o;l&&(c.push(l),l!=s);l=l.nextSibling);return tinymce.each(c,function(e){if(d(e))return r.push(e),n=null,void 0;if(L.isBlock(e)||"BR"==e.nodeName)return"BR"==e.nodeName&&L.remove(e),n=null,void 0;var t=e.nextSibling;return f(e)&&(d(t)||!t&&e.parentNode==i)?(n=null,void 0):(n||(n=L.create("p"),e.parentNode.insertBefore(n,e),r.push(n)),n.appendChild(e),void 0)}),r}var a=b.getRng(!0),s=n(a),c=o();tinymce.each(c,function(e){var n,r;r=e.previousSibling,r&&i(r)&&r.nodeName==t?(n=r,e=L.rename(e,"LI"),r.appendChild(e)):(n=L.create(t),e.parentNode.insertBefore(n,e),n.appendChild(e),e=L.rename(e,"LI")),u(n)}),r(s)}function g(){var t=n(b.getRng(!0)),o=e.getBody();tinymce.each(c(),function(e){var t,n;if(L.isEmpty(e))return m(e),void 0;for(t=e;t&&t!=o;t=t.parentNode)i(t)&&(n=t);l(n,e)}),r(t)}function y(e){var t=L.getParent(b.getStart(),"OL,UL");if(t)if(t.nodeName==e)g(e);else{var i=n(b.getRng(!0));u(L.rename(t,e)),r(i)}else C(e)}var L=e.dom,b=e.selection;t.backspaceDelete=function(e){function t(e,t){var n=e.startContainer,r=e.startOffset;if(3==n.nodeType&&(t?r<n.data.length:r>0))return n;for(var i=new tinymce.dom.TreeWalker(e.startContainer);n=i[t?"next":"prev"]();)if(3==n.nodeType&&n.data.length>0)return n}function o(e,t){var n,r,o=e.parentNode;for(i(t.lastChild)&&(r=t.lastChild),n=t.lastChild,n&&"BR"==n.nodeName&&e.hasChildNodes()&&L.remove(n);n=e.firstChild;)t.appendChild(n);r&&t.appendChild(r),L.remove(e),L.isEmpty(o)&&L.remove(o)}if(b.isCollapsed()){var a=L.getParent(b.getStart(),"LI");if(a){var d=b.getRng(!0),f=L.getParent(t(d,e),"LI");if(f&&f!=a){var s=n(d);return e?o(f,a):o(a,f),r(s),!0}if(!f&&!e&&g(a.parentNode.nodeName))return!0}}},e.addCommand("Indent",function(){return N()?void 0:!0}),e.addCommand("Outdent",function(){return h()?void 0:!0}),e.addCommand("InsertUnorderedList",function(){y("UL")}),e.addCommand("InsertOrderedList",function(){y("OL")})}),e.on("keydown",function(e){e.keyCode==tinymce.util.VK.BACKSPACE?t.backspaceDelete()&&e.preventDefault():e.keyCode==tinymce.util.VK.DELETE&&t.backspaceDelete(!0)&&e.preventDefault()})});